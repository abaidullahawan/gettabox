<!-- Main Content Header -->
<div class="main-content-header mt-3">
  <h1>Order Dispatch</h1>
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="<%= home_path %>">Dashboard</a>
    </li>
    <li class="breadcrumb-item active">
      <span class="active">Order Dispatch</span>
    </li>
  </ol>
    <div class= 'mb-3 float-right'>
      <%= link_to 'Export', order_dispatches_path(format: :csv, export_csv: true), class: 'btn btn-sm btn-primary' %>
    </div>
</div>
<!-- End Main Content Header -->
<div class='row mb-4' style="margin-left: 0px;">
  <div class="col-md-3">
    <%= search_form_for @q, url: order_dispatches_path(request.parameters.excluding('controller', 'action')), method: :get do |f| %>
      <%= f.select :channel_type_eq, options_for_select(@channel_types.map { |key, value| [key.humanize, value] }, f.object.channel_type_eq), {include_blank: "Select Status", hide_label:true, required: true }, class:"bg-white form-control order-mapping-select", title: 'Select Mapping Category', prompt: "Please select" %>
      <%= hidden_field_tag "order_filter", params[:order_filter] %>
      <%= f.submit 'Mapping', class: 'btn btn-primary product-mapping-request d-none' %>
    <% end %>
  </div>
  <div class="col-md-2">
    <%= search_form_for @q, url: order_dispatches_path(request.parameters.excluding('controller', 'action')), method: :get do |f| %>
      <%= hidden_field_tag "order_filter", params[:order_filter] %>
      <%= f.search_field :ebayorder_id_or_order_status_or_buyer_name_cont, class:"form-control bg-white text-black", title: 'Search Buyer Name or Order Id or Status', placeholder: 'Search Buyer Name or Order Id or Status' %>
    <% end %>
  </div>
  <div class="col-md-3 d-flex">
    <%#= link_to "eBay Orders", order_dispatches_path(orders_api: true, ebay: true) ,class:"btn btn-primary", type:"button", style: "color: white;" %>
    <%#= link_to "Amazon Orders", order_dispatches_path(orders_api: true, amazon: true) ,class:"btn btn-primary ml-3", type:"button", style: "color: white;" %>
  </div>
</div>
<div class="row" style="margin-left: 0px;">
  <div class="col-lg-2">
    <div class="card text-center mb-30">
      <div class="header card-header">Order</div>
      <div class="card-body">
        <div class="card-title h5 text-success"><%= @today_orders %></div>
      </div>
    </div>
  </div>

  <div class="col-lg-2">
    <div class="card text-center mb-30">
      <div class="header card-header">Order Issues</div>
      <div class="card-body">
        <div class="card-title h5 text-danger"><%= @issue_orders_count %></div>
      </div>
    </div>
  </div>

  <div class="col-lg-2">
    <%= link_to product_mappings_path do %>
      <div class="card text-center mb-30">
        <div class="header card-header">Product</div>
        <div class="card-body">
          <div class="card-title h5 text-success"><%= @total_products_count %></div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="col-lg-2">
  <%= link_to product_mappings_path(issue_product: true) do %>
    <div class="card text-center mb-30">
      <div class="header card-header">Product Issues</div>
      <div class="card-body">
        <input name='product_issue' type='hidden'>
        <div class="card-title h5 text-danger"><%= @issue_products_count %></div>
      </div>
    </div>
  <% end %>
  </div>
</div>

<div class="col-lg-12">
  <div class="card mb-30">
    <div class="card-body">
      <div class="tabs-style-two">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link <%= 'active' if params[:order_filter].eql? 'unprocessed' %>" href=<%= order_dispatches_path(order_filter: 'unprocessed', q: { channel_type_eq: params[:q].try(:[], :channel_type_eq), ebayorder_id_or_order_status_or_buyer_name_cont: params[:q].try(:[], :ebayorder_id_or_order_status_or_buyer_name_cont)})%>><%= "Unprocessed Orders (#{@unmatched_sku_count.to_i + @un_matched_orders_count.to_i})" %></a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= 'active' if params[:order_filter].eql? 'ready' %>" href=<%= order_dispatches_path(order_filter: 'ready', q: { channel_type_eq: params[:q].try(:[], :channel_type_eq), ebayorder_id_or_order_status_or_buyer_name_cont: params[:q].try(:[], :ebayorder_id_or_order_status_or_buyer_name_cont)})%>><%= "Ready to Dispatch(#{@not_started_orders.count})" %></a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= 'active' if params[:order_filter].eql? 'assignment' %>" href=<%= order_dispatches_path(order_filter: 'assignment', q: { channel_type_eq: params[:q].try(:[], :channel_type_eq), ebayorder_id_or_order_status_or_buyer_name_cont: params[:q].try(:[], :ebayorder_id_or_order_status_or_buyer_name_cont)})%>><%= "Order for Assignment" %></a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= 'active' if params[:order_filter].eql? 'issue' %>" href=<%= order_dispatches_path(order_filter: 'issue', q: { channel_type_eq: params[:q].try(:[], :channel_type_eq), ebayorder_id_or_order_status_or_buyer_name_cont: params[:q].try(:[], :ebayorder_id_or_order_status_or_buyer_name_cont)})%>><%= "Issue Orders (#{@issue_orders_count.to_i})"%></a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= 'active' if params[:order_filter].eql? 'completed' %>" href=<%= order_dispatches_path(order_filter: 'completed', q: { channel_type_eq: params[:q].try(:[], :channel_type_eq), ebayorder_id_or_order_status_or_buyer_name_cont: params[:q].try(:[], :ebayorder_id_or_order_status_or_buyer_name_cont)})%>><%= "Completed Orders (#{@completed_count.to_i})"%></a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= 'active' if params[:order_filter].eql? 'unpaid' %>" href=<%= order_dispatches_path(order_filter: 'unpaid', q: { channel_type_eq: params[:q].try(:[], :channel_type_eq), ebayorder_id_or_order_status_or_buyer_name_cont: params[:q].try(:[], :ebayorder_id_or_order_status_or_buyer_name_cont)})%>><%= "Unpaid Orders (#{@unpaid_orders_count.to_i})"%></a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade <%= 'show active' if params[:order_filter].eql? 'unprocessed' %>" id="demo_two_home" role="tabpanel">
            <%= render 'unprocessed_orders' if params[:order_filter].eql? 'unprocessed' %>
          </div>
          <div class="tab-pane fade <%= 'show active' if params[:order_filter].eql? 'ready' %>" id="demo_three_home" role="tabpanel">
            <%= render 'ready_to_dispatch_orders' if params[:order_filter].eql? 'ready' %>
          </div>
          <div class="tab-pane fade <%= 'show active' if params[:order_filter].eql? 'assignment' %>" id="demo_four_home" role="tabpanel">
            <%= render 'order_for_assignment' if params[:order_filter].eql? 'assignment' %>
          </div>
          <div class="tab-pane fade <%= 'show active' if params[:order_filter].eql? 'issue' %>" id="demo_five_home" role="tabpanel">
            <%= render 'issue_orders' if params[:order_filter].eql? 'issue' %>
          </div>
          <div class="tab-pane fade <%= 'show active' if params[:order_filter].eql? 'completed' %>" id="demo_six_home" role="tabpanel">
            <%= render 'completed_orders' if params[:order_filter].eql? 'completed' %>
          </div>
          <div class="tab-pane fade <%= 'show active' if params[:order_filter].eql? 'unpaid' %>" id="demo_seven_home" role="tabpanel">
            <%= render 'unpaid_orders' if params[:order_filter].eql? 'unpaid' %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>